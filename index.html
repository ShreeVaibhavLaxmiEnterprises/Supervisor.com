<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nirmal Enterprise Tracker</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 10px; background: #f5f5f5; }
        
        /* Main Container */
        .app-box { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); max-width: 600px; margin: 0 auto; }
        
        h2, h3 { text-align: center; color: #d32f2f; margin-top: 0; }
        
        /* Inputs */
        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        label { font-weight: bold; font-size: 0.9em; }

        /* Buttons */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 5px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-green { background: #2e7d32; }
        .btn-blue { background: #1976d2; }
        .btn-red { background: #c62828; margin-top: 20px; }
        .btn-grey { background: #555; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #e3f2fd; }

        /* Print Template (Hidden normally) */
        #printArea { display: none; border: 2px solid black; padding: 20px; background: white; }

        /* Print Logic */
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; display: block !important; }
        }
    </style>
</head>
<body>

<div class="app-box" id="mainUI">
    <h2>Shree Vaibhav Laxmi Enterprises</h2>
    <p style="text-align:center;">Supervisor: Siddharth Yadav</p>

    <div id="statusBox" style="display:none; padding:10px; margin-bottom:10px; text-align:center; border-radius:5px;"></div>

    <button class="btn btn-grey" onclick="toggle('workerSection')">‚ûï Worker Manage Karein</button>
    <div id="workerSection" style="display:none; background:#eee; padding:10px; margin-top:10px;">
        <h4>Add Worker</h4>
        <input type="text" id="wName" placeholder="Worker Name">
        <input type="number" id="wRate" placeholder="Rate (‚Çπ)">
        <select id="wType"><option>Mistri</option><option>Helper</option></select>
        <button class="btn btn-green" onclick="addWorker()">Save Worker</button>
        <ul id="workerList" style="padding-left:20px;"></ul>
    </div>

    <hr>

    <h3>Daily Entry</h3>
    <label>Date:</label>
    <input type="date" id="date">
    <label>Site Name:</label>
    <input type="text" id="site">
    
    <label style="background:#e3f2fd; padding:5px; display:block;">Hajari (Attendance):</label>
    <div id="attendanceArea"></div>
    
    <label>Work Details:</label>
    <textarea id="work" placeholder="Aaj ka kaam..."></textarea>
    
    <label>Material IN/OUT:</label>
    <input type="text" id="matIn" placeholder="IN (Maal Aaya)">
    <input type="text" id="matOut" placeholder="OUT (Maal Laga)">

    <button class="btn btn-green" onclick="saveRecord()">üíæ SAVE & PDF</button>

    <hr>

    <button class="btn btn-blue" onclick="toggle('calcSection')">üßÆ Hisab Kitab / Bill</button>
    <div id="calcSection" style="display:none; background:#e3f2fd; padding:10px; margin-top:10px;">
        <select id="calcWorker"><option>Worker Select...</option></select>
        <button class="btn btn-blue" onclick="calculate()">Check Hisab</button>
        <div id="calcResult" style="display:none; margin-top:10px;">
            <p>Total: <b id="resTotal"></b></p>
            <button class="btn btn-green" onclick="printBill()">Print Bill PDF</button>
        </div>
    </div>

    <h4>Saved Records</h4>
    <div style="overflow-x:auto;">
        <table id="recordTable">
            <thead><tr><th>Date</th><th>Site</th><th>Action</th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <button class="btn btn-red" onclick="hardReset()">‚ö†Ô∏è RESET / CLEAR DATA (Fix Problem)</button>
</div>

<div id="printArea">
    <h2 style="text-align:center; text-decoration:underline;">PAYMENT VOUCHER</h2>
    <h3 style="text-align:center;">Shree Vaibhav Laxmi Enterprises</h3>
    <br>
    <p><b>Date:</b> <span id="pDate"></span></p>
    <p><b>Worker/Site:</b> <span id="pName"></span></p>
    
    <table style="width:100%; border:1px solid black; margin-top:20px;">
        <tr style="background:#ddd;">
            <th style="border:1px solid black;">Description</th>
            <th style="border:1px solid black; text-align:right;">Amount</th>
        </tr>
        <tr>
            <td style="border:1px solid black; padding:10px;" id="pDesc"></td>
            <td style="border:1px solid black; text-align:right; padding:10px;" id="pAmt"></td>
        </tr>
    </table>
    
    <br><br><br>
    <div style="display:flex; justify-content:space-between;">
        <span>Supervisor Sig.</span>
        <span>Worker Sig.</span>
    </div>
</div>

<script>
    // --- APP LOGIC ---
    let workers = JSON.parse(localStorage.getItem('wk_list')) || [];
    let records = JSON.parse(localStorage.getItem('rec_list')) || [];
    let currentPrintData = {};

    window.onload = function() {
        document.getElementById('date').valueAsDate = new Date();
        renderUI();
    };

    function toggle(id) {
        let el = document.getElementById(id);
        el.style.display = (el.style.display === 'none') ? 'block' : 'none';
    }

    // WORKER FUNCTIONS
    function addWorker() {
        let name = document.getElementById('wName').value;
        let rate = document.getElementById('wRate').value;
        let type = document.getElementById('wType').value;
        if(!name) return alert("Name is empty!");
        
        workers.push({id: Date.now(), name, rate, type});
        localStorage.setItem('wk_list', JSON.stringify(workers));
        alert("Worker Added!");
        renderUI();
    }

    // SAVE RECORD
    function saveRecord() {
        let date = document.getElementById('date').value;
        let site = document.getElementById('site').value;
        if(!site) return alert("Site Name likhein!");

        let attList = [];
        let total = 0;

        workers.forEach(w => {
            let inp = document.getElementById('att_' + w.id);
            if(inp && inp.value > 0) {
                let pay = inp.value * w.rate;
                attList.push({name: w.name, val: inp.value, pay: pay});
                total += pay;
            }
        });

        let rec = {
            id: Date.now(),
            date, site,
            work: document.getElementById('work').value,
            matIn: document.getElementById('matIn').value,
            matOut: document.getElementById('matOut').value,
            attList, total
        };

        try {
            records.unshift(rec);
            localStorage.setItem('rec_list', JSON.stringify(records));
            showStatus("Record Saved Successfully!", "green");
            renderUI();
            
            // Auto Print Daily Report
            printDailyReport(rec);

        } catch(e) {
            alert("Storage Full! Purana data delete karein.");
        }
    }

    // CALCULATOR
    function calculate() {
        let name = document.getElementById('calcWorker').value;
        if(name === "Worker Select...") return;
        
        let tPay = 0;
        let tDays = 0;
        
        records.forEach(r => {
            let entry = r.attList.find(a => a.name === name);
            if(entry) {
                tDays += parseFloat(entry.val);
                tPay += parseFloat(entry.pay);
            }
        });

        document.getElementById('resTotal').innerText = "‚Çπ" + tPay + " (" + tDays + " days)";
        document.getElementById('calcResult').style.display = 'block';
        
        currentPrintData = {
            date: new Date().toLocaleDateString(),
            name: name,
            desc: "Total Work Payment",
            amt: "‚Çπ" + tPay
        };
    }

    // PRINTING
    function printDailyReport(rec) {
        document.getElementById('pDate').innerText = rec.date;
        document.getElementById('pName').innerText = rec.site;
        
        let descHtml = "<b>Work:</b> " + rec.work + "<br>";
        if(rec.matIn) descHtml += "<b>IN:</b> " + rec.matIn + "<br>";
        if(rec.matOut) descHtml += "<b>OUT:</b> " + rec.matOut + "<br><hr>";
        
        rec.attList.forEach(a => {
            descHtml += a.name + ": " + a.val + " Hajari (‚Çπ" + a.pay + ")<br>";
        });

        document.getElementById('pDesc').innerHTML = descHtml;
        document.getElementById('pAmt').innerText = "Total: ‚Çπ" + rec.total;
        
        window.print();
    }

    function printBill() {
        document.getElementById('pDate').innerText = currentPrintData.date;
        document.getElementById('pName').innerText = currentPrintData.name;
        document.getElementById('pDesc').innerText = currentPrintData.desc;
        document.getElementById('pAmt').innerText = currentPrintData.amt;
        window.print();
    }

    // UI RENDERER
    function renderUI() {
        // Worker List
        let ul = document.getElementById('workerList');
        let sel = document.getElementById('calcWorker');
        let attDiv = document.getElementById('attendanceArea');
        
        ul.innerHTML = "";
        sel.innerHTML = "<option>Worker Select...</option>";
        attDiv.innerHTML = "";

        workers.forEach(w => {
            ul.innerHTML += `<li>${w.name} - ‚Çπ${w.rate}</li>`;
            sel.innerHTML += `<option value="${w.name}">${w.name}</option>`;
            attDiv.innerHTML += `
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span>${w.name}</span>
                    <input type="number" id="att_${w.id}" placeholder="0" style="width:60px; margin:0;">
                </div>`;
        });

        // Records Table
        let tbody = document.getElementById('tableBody');
        tbody.innerHTML = "";
        records.forEach(r => {
            tbody.innerHTML += `
                <tr>
                    <td>${r.date}</td>
                    <td>${r.site}</td>
                    <td><button style="background:red; color:white; border:none;" onclick="delRec(${r.id})">X</button></td>
                </tr>`;
        });
    }

    function delRec(id) {
        if(confirm("Delete?")) {
            records = records.filter(r => r.id !== id);
            localStorage.setItem('rec_list', JSON.stringify(records));
            renderUI();
        }
    }

    function showStatus(msg, color) {
        let box = document.getElementById('statusBox');
        box.innerText = msg;
        box.style.background = color === "green" ? "#c8e6c9" : "#ffcdd2";
        box.style.display = 'block';
        setTimeout(() => box.style.display = 'none', 3000);
    }

    function hardReset() {
        if(confirm("Sabhi purana data delete ho jayega. Kya aap sure hain?")) {
            localStorage.clear();
            location.reload();
        }
    }
</script>

</body>
</html>
