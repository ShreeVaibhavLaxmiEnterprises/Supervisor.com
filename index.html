<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHREE VAIBHAV LAXMI ENTERPRISES - Full System</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; background-color: #f4f6f9; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Header */
        h1 { color: #2c3e50; text-align: center; margin: 0; }
        .sub-header { text-align: center; color: #7f8c8d; font-size: 14px; margin-bottom: 15px; }

        /* TAB NAVIGATION */
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: #f1f1f1; cursor: pointer; font-size: 16px; font-weight: bold; }
        .tab-btn.active { background: #3498db; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* General Styles */
        .section-title { background-color: #2c3e50; color: white; padding: 10px; margin-top: 20px; border-radius: 4px; font-weight: bold; }
        .summary-box { background-color: #e8f6f3; border: 1px solid #1abc9c; padding: 10px; margin-top: 10px; display: flex; justify-content: space-around; font-weight: bold; color: #16a085; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 13px; }
        th { background-color: #eee; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        
        /* Buttons */
        .btn-add { background: #27ae60; color: white; padding: 8px; border: none; cursor: pointer; border-radius: 4px; margin-top: 5px; }
        .btn-save { background: #2980b9; width: 100%; padding: 15px; color: white; font-size: 18px; border: none; margin-top: 20px; cursor: pointer; border-radius: 5px; }
        .btn-pdf { background: #e67e22; width: 100%; padding: 15px; color: white; font-size: 18px; border: none; margin-top: 10px; cursor: pointer; border-radius: 5px; }
        .btn-download { background: #8e44ad; color: white; padding: 10px; border: none; cursor: pointer; border-radius: 4px; float: right; margin-bottom: 10px; }

        /* Search Bar */
        .search-bar { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #3498db; border-radius: 25px; outline: none; }

        @media print {
            .tabs, .btn-add, .btn-save, .btn-pdf, .btn-download, #dbSection { display: none !important; }
            #entrySection { display: block !important; }
            body { background: white; }
            .container { box-shadow: none; border: none; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>SHREE VAIBHAV LAXMI ENTERPRISES</h1>
    <div class="sub-header">TRACK LIST </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('entry')">üìù Daily Entry</button>
        <button class="tab-btn" onclick="switchTab('db')">üîç Search Records</button>
    </div>

    <div id="entrySection" class="tab-content active">
        <form id="reportForm">
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><label>Date:</label><input type="date" id="mainDate"></div>
                <div style="flex:1"><label>Site:</label><input type="text" id="siteName" placeholder="Site Name"></div>
            </div>

            <div class="section-title">Labour Details</div>
            <div class="summary-box">
                <span>Carp: <span id="cCarp">0</span></span>
                <span>Fit: <span id="cFit">0</span></span>
                <span>Help: <span id="cHelp">0</span></span>
                <span>Total: <span id="cTotal">0</span></span>
            </div>

            <div style="overflow-x:auto;">
                <table id="labourTable">
                    <thead>
                        <tr>
                            <th>Name</th><th>Type</th><th>Rate</th><th>Att</th><th>Adv</th><th>Total</th><th>X</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <button type="button" class="btn-add" onclick="addWorkerRow()">+ Add Worker</button>

            <div class="section-title">Work & Material</div>
            <textarea id="materialBox" rows="2" placeholder="Material In/Out..."></textarea>
            <textarea id="workBox" rows="2" placeholder="Work Done Description..."></textarea>
            
            <div class="section-title">Issues / Requirements</div>
            <textarea id="issueBox" rows="2" placeholder="Urgent needs..."></textarea>

            <button type="button" class="btn-save" onclick="saveToDatabase()">üíæ SAVE DATA TO SYSTEM</button>
            <button type="button" class="btn-pdf" onclick="window.print()">üñ®Ô∏è PRINT / PDF</button>
        </form>
    </div>

    <div id="dbSection" class="tab-content">
        <button onclick="downloadExcel()" class="btn-download">‚¨á Download Excel</button>
        <input type="text" id="searchInput" class="search-bar" placeholder="üîç Search by Name, Date, or Site..." onkeyup="searchDatabase()">
        
        <div style="overflow-x:auto;">
            <table id="searchTable">
                <thead>
                    <tr style="background:#34495e; color:white;">
                        <th>Date</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Site</th>
                        <th>Rate</th>
                        <th>Att</th>
                        <th>Adv</th>
                        <th>Payable</th>
                    </tr>
                </thead>
                <tbody id="dbBody">
                    </tbody>
            </table>
        </div>
        <p style="text-align:center; color:red; font-size:12px; margin-top:20px;">
            Note: Data is saved in this browser. Do not clear 'Browsing Data'. Use "Download Excel" weekly for backup.
        </p>
    </div>

</div>

<script>
    // --- INITIALIZATION ---
    document.getElementById('mainDate').valueAsDate = new Date();
    window.onload = function() {
        addWorkerRow();
        loadDatabase(); // Load saved data on start
    };

    // --- TAB LOGIC ---
    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        
        if(tabName === 'entry') {
            document.getElementById('entrySection').classList.add('active');
            document.querySelectorAll('.tab-btn')[0].classList.add('active');
        } else {
            document.getElementById('dbSection').classList.add('active');
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            loadDatabase(); // Refresh data when opening tab
        }
    }

    // --- FORM LOGIC ---
    function addWorkerRow() {
        const table = document.getElementById("labourTable").getElementsByTagName('tbody')[0];
        const newRow = table.insertRow();
        newRow.innerHTML = `
            <td><input type="text" class="w-name" placeholder="Name"></td>
            <td><select class="w-type" onchange="updateCounts()"><option>Carpenter</option><option>Fitter</option><option>Helper</option><option>Other</option></select></td>
            <td><input type="number" class="rate" oninput="calcRow(this)" placeholder="0"></td>
            <td><input type="number" class="att" oninput="calcRow(this)" placeholder="1"></td>
            <td><input type="number" class="adv" oninput="calcRow(this)" placeholder="0"></td>
            <td><input type="number" class="total" readonly style="background:#eee;"></td>
            <td><button onclick="deleteRow(this)" style="color:red;">x</button></td>
        `;
        updateCounts();
    }

    function calcRow(el) {
        const row = el.closest('tr');
        const rate = row.querySelector('.rate').value || 0;
        const att = row.querySelector('.att').value || 0;
        const adv = row.querySelector('.adv').value || 0;
        row.querySelector('.total').value = (rate * att) - adv;
    }

    function deleteRow(btn) { btn.closest('tr').remove(); updateCounts(); }

    function updateCounts() {
        let counts = {Carpenter:0, Fitter:0, Helper:0, Other:0};
        document.querySelectorAll('.w-type').forEach(s => counts[s.value]++);
        document.getElementById('cCarp').innerText = counts.Carpenter;
        document.getElementById('cFit').innerText = counts.Fitter;
        document.getElementById('cHelp').innerText = counts.Helper;
        document.getElementById('cTotal').innerText = counts.Carpenter + counts.Fitter + counts.Helper + counts.Other;
    }

    // --- DATABASE & SAVE LOGIC ---
    function saveToDatabase() {
        if(!confirm("Are you sure you want to save this data?")) return;

        const date = document.getElementById('mainDate').value;
        const site = document.getElementById('siteName').value || "Unknown";
        let newRecords = [];

        // Loop through all worker rows
        document.querySelectorAll('#labourTable tbody tr').forEach(row => {
            const name = row.querySelector('.w-name').value;
            if(name) {
                newRecords.push({
                    date: date,
                    site: site,
                    name: name,
                    type: row.querySelector('.w-type').value,
                    rate: row.querySelector('.rate').value,
                    att: row.querySelector('.att').value,
                    adv: row.querySelector('.adv').value,
                    payable: row.querySelector('.total').value
                });
            }
        });

        // Get existing data from LocalStorage
        let existingData = JSON.parse(localStorage.getItem('nirmalData')) || [];
        // Add new records
        existingData = [...newRecords, ...existingData];
        // Save back to LocalStorage
        localStorage.setItem('nirmalData', JSON.stringify(existingData));

        alert("Data Saved Successfully! Check 'Search Records' tab.");
        document.getElementById('reportForm').reset();
        addWorkerRow(); // Add clean row
        document.getElementById('mainDate').valueAsDate = new Date();
    }

    // --- SEARCH LOGIC ---
    function loadDatabase(filter = "") {
        const data = JSON.parse(localStorage.getItem('nirmalData')) || [];
        const tbody = document.getElementById('dbBody');
        tbody.innerHTML = "";
        
        // Filter logic
        const filteredData = data.filter(item => {
            const searchStr = (item.name + item.date + item.site + item.type).toLowerCase();
            return searchStr.includes(filter.toLowerCase());
        });

        filteredData.forEach(item => {
            const row = `<tr>
                <td>${item.date}</td>
                <td><strong>${item.name}</strong></td>
                <td>${item.type}</td>
                <td>${item.site}</td>
                <td>${item.rate}</td>
                <td>${item.att}</td>
                <td>${item.adv}</td>
                <td style="font-weight:bold;">${item.payable}</td>
            </tr>`;
            tbody.innerHTML += row;
        });
    }

    function searchDatabase() {
        const query = document.getElementById('searchInput').value;
        loadDatabase(query);
    }

    // --- BACKUP LOGIC (CSV) ---
    function downloadExcel() {
        const data = JSON.parse(localStorage.getItem('nirmalData')) || [];
        if(data.length === 0) { alert("No data to download!"); return; }
        
        let csvContent = "data:text/csv;charset=utf-8,Date,Name,Type,Site,Rate,Attendance,Advance,Payable\n";
        
        data.forEach(row => {
            csvContent += `${row.date},${row.name},${row.type},${row.site},${row.rate},${row.att},${row.adv},${row.payable}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "Nirmal_Labour_Data.csv");
        document.body.appendChild(link);
        link.click();
    }
</script>

</body>
                    </html>
