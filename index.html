<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Construction Worker Tracker – PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding:10px}
.app{max-width:1000px;margin:auto;background:#fff;padding:15px;border-radius:8px}
h2{text-align:center;color:#c62828;margin:5px 0}
.section{border:1px solid #ccc;margin-top:15px;padding:10px;border-radius:5px}
label{font-weight:bold;font-size:14px}
input,select{width:100%;padding:6px;margin-top:3px}
button{padding:8px 12px;border:none;color:#fff;font-weight:bold;cursor:pointer;margin-top:6px}
.blue{background:#1976d2}
.green{background:#2e7d32}
.red{background:#c62828}
.purple{background:#6a1b9a}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
th,td{border:1px solid #999;padding:6px;text-align:center}
.total{font-weight:bold;font-size:16px;margin-top:10px}
.bill{border:2px solid #000;padding:15px;margin-top:20px}
.stamp{font-size:22px;font-weight:bold;border:3px solid;padding:5px 12px;display:inline-block}
.paid{color:green;border-color:green}
.unpaid{color:red;border-color:red}
@media print {.no-print{display:none}}
</style>
</head>

<body>
<div class="app">

<h2>Shree Vaibhav Laxmi Enterprises</h2>
<p style="text-align:center">Supervisor: Siddharth Yadav</p>

<!-- WORKER MASTER -->
<div class="section">
<h3>Worker Master List</h3>
<input id="wmName" placeholder="Worker Name">
<input id="wmRate" type="number" placeholder="Daily Rate ₹">
<button class="blue" onclick="addWorker()">Add Worker</button>
<div id="workerList"></div>
</div>

<!-- DAILY ENTRY -->
<div class="section">
<h3>Daily Entry (Multiple Workers)</h3>

<label>Date</label>
<input type="date" id="workDate">

<label>Site Name</label>
<input id="siteName">

<table id="workerTable">
<thead>
<tr>
<th>Worker</th>
<th>Hajri</th>
<th>Rate ₹</th>
<th>Advance ₹</th>
<th>Remove</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button class="blue no-print" onclick="addRow()">➕ Add Worker Row</button>

<div class="total">Total Amount: ₹ <span id="totalAmt">0</span></div>

<button class="green no-print" onclick="saveDay()">Save Daily Record</button>
</div>

<!-- MONTHLY CLOSING -->
<div class="section no-print">
<h3>Monthly Closing</h3>
<input type="month" id="closeMonth">
<button class="purple" onclick="monthlyClosing()">Generate Monthly Report</button>
</div>

<div id="monthlyArea"></div>

</div>

<script>
let workers = JSON.parse(localStorage.getItem("workers_master")||"[]");
let records = JSON.parse(localStorage.getItem("daily_records")||"[]");

function saveLS(){
localStorage.setItem("workers_master",JSON.stringify(workers));
localStorage.setItem("daily_records",JSON.stringify(records));
}

function addWorker(){
let n=wmName.value.trim(), r=+wmRate.value;
if(!n||!r)return alert("Name & Rate required");
workers.push({name:n,rate:r});
saveLS();
wmName.value=""; wmRate.value="";
renderWorkers();
}

function renderWorkers(){
workerList.innerHTML=workers.map(w=>`• ${w.name} (₹${w.rate})`).join("<br>");
document.querySelectorAll(".wSelect").forEach(sel=>{
sel.innerHTML=workers.map(w=>`<option value="${w.name}|${w.rate}">${w.name}</option>`).join("");
});
}
renderWorkers();

function addRow(){
let tr=document.createElement("tr");
tr.innerHTML=`
<td>
<select class="wSelect" onchange="fillRate(this)">
${workers.map(w=>`<option value="${w.name}|${w.rate}">${w.name}</option>`).join("")}
</select>
</td>
<td><input type="number" step="0.5" value="1" oninput="calcTotal()"></td>
<td><input type="number" value="0" oninput="calcTotal()"></td>
<td><input type="number" value="0" oninput="calcTotal()"></td>
<td><button class="red" onclick="this.closest('tr').remove();calcTotal()">X</button></td>`;
document.querySelector("#workerTable tbody").appendChild(tr);
calcTotal();
}

function fillRate(sel){
let rate=sel.value.split("|")[1];
sel.closest("tr").children[2].firstElementChild.value=rate;
calcTotal();
}

addRow();

function calcTotal(){
let t=0;
document.querySelectorAll("#workerTable tbody tr").forEach(r=>{
let h=+r.children[1].firstElementChild.value||0;
let rate=+r.children[2].firstElementChild.value||0;
let adv=+r.children[3].firstElementChild.value||0;
t+=h*rate-adv;
});
totalAmt.innerText=t;
}

function saveDay(){
let date=workDate.value,site=siteName.value;
if(!date||!site)return alert("Date & Site required");

let w=[];
document.querySelectorAll("#workerTable tbody tr").forEach(r=>{
let [n,rate]=r.children[0].firstElementChild.value.split("|");
let h=+r.children[1].firstElementChild.value;
let adv=+r.children[3].firstElementChild.value;
if(h>0||adv>0) w.push({n,h,rate:+rate,adv,paid:false});
});

records.push({date,site,workers:w});
saveLS();
alert("Daily record saved");
document.querySelector("#workerTable tbody").innerHTML="";
addRow(); calcTotal();
}

function monthlyClosing(){
let m=closeMonth.value;
if(!m)return alert("Month select karein");

let map={};
records.forEach(r=>{
if(!r.date.startsWith(m))return;
r.workers.forEach(w=>{
if(!map[w.n]) map[w.n]={h:0,adv:0,amt:0,paid:w.paid};
map[w.n].h+=w.h;
map[w.n].adv+=w.adv;
map[w.n].amt+=w.h*w.rate-w.adv;
});
});

let html=`<div class="bill">
<h3>MONTHLY CLOSING - ${m}</h3>
<table>
<tr><th>Worker</th><th>Hajri</th><th>Advance</th><th>Net ₹</th><th>Status</th></tr>
`;

for(let k in map){
html+=`<tr>
<td>${k}</td>
<td>${map[k].h}</td>
<td>₹${map[k].adv}</td>
<td><b>₹${map[k].amt}</b></td>
<td>
<span class="stamp ${map[k].paid?'paid':'unpaid'}">
${map[k].paid?'PAID':'UNPAID'}
</span>
</td>
</tr>`;
}

html+=`</table>
<button class="blue no-print" onclick="window.print()">Print / Save PDF</button>
</div>`;

monthlyArea.innerHTML=html;
}
</script>

</body>
</html>
