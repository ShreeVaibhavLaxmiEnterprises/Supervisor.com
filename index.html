<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shree Vaibhav Laxmi Enterprises</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:10px}
h2,h3{text-align:center}
.box{background:#fff;padding:10px;margin:10px 0;border-radius:8px}
input,select,textarea,button{width:100%;margin:5px 0;padding:8px}
button{background:#2e86de;color:#fff;border:none;border-radius:5px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
img{max-width:100px}
.del{background:red}
</style>
</head>

<body>

<h2>Shree Vaibhav Laxmi Enterprises</h2>
<p style="text-align:center"><b>Supervisor:</b> Siddharth Yadav | Tracking Website</p>

<!-- WORKER ADD -->
<div class="box">
<h3>Worker Add Karein</h3>
<input id="wname" placeholder="Worker Name">
<select id="wtype">
<option>Mistry</option>
<option>Helper</option>
<option>Other</option>
</select>
<input id="wrate" placeholder="Daily Rate ₹">
<button onclick="addWorker()">Add Worker</button>

<table id="workerTable">
<tr><th>Name</th><th>Type</th><th>Rate</th><th>Del</th></tr>
</table>
</div>

<!-- DAILY ENTRY -->
<div class="box">
<h3>Daily Entry (रोज़ का काम)</h3>
<input type="date" id="date">
<input placeholder="Site Name" id="site">

<select id="workerSelect"></select>

<select id="hajri">
<option value="1">Full Day (1)</option>
<option value="0.5">Half Day (0.5)</option>
</select>

<input placeholder="Maal Aaya (IN)" id="in">
<input placeholder="Maal Laga (OUT)" id="out">
<textarea placeholder="Aaj ka Kaam" id="work"></textarea>
<input type="file" id="img">

<button onclick="saveDaily()">Save Daily Record</button>
</div>

<!-- SAVED RECORDS -->
<div class="box">
<h3>Saved Records</h3>
<table id="recordTable">
<tr>
<th>Date/Site</th>
<th>Work & Material</th>
<th>Payment</th>
<th>Image</th>
<th>Del</th>
</tr>
</table>
<button onclick="dailyPDF()">Generate Daily PDF</button>
</div>

<!-- HISAB KITAB -->
<div class="box">
<h3>Hisab Kitab</h3>
<select id="hisabWorker"></select>
<input type="date" id="from">
<input type="date" id="to">
<button onclick="hisab()">Check Hisab</button>
<p id="hisabResult"></p>
<button onclick="hisabPDF()">Generate Hisab PDF</button>
</div>

<script>
let workers=JSON.parse(localStorage.getItem("workers")||"[]");
let records=JSON.parse(localStorage.getItem("records")||"[]");

function save(){
localStorage.setItem("workers",JSON.stringify(workers));
localStorage.setItem("records",JSON.stringify(records));
}

function addWorker(){
workers.push({
name:wname.value,
type:wtype.value,
rate:parseFloat(wrate.value)
});
save(); load();
wname.value=wrate.value="";
}

function delWorker(i){
workers.splice(i,1); save(); load();
}

function load(){
workerTable.innerHTML="<tr><th>Name</th><th>Type</th><th>Rate</th><th>Del</th></tr>";
workerSelect.innerHTML="";
hisabWorker.innerHTML="";

workers.forEach((w,i)=>{
workerTable.innerHTML+=`<tr>
<td>${w.name}</td><td>${w.type}</td><td>₹${w.rate}</td>
<td><button class="del" onclick="delWorker(${i})">X</button></td></tr>`;
workerSelect.innerHTML+=`<option value="${i}">${w.name}</option>`;
hisabWorker.innerHTML+=`<option value="${i}">${w.name}</option>`;
});

recordTable.innerHTML=`<tr>
<th>Date/Site</th><th>Work & Material</th>
<th>Payment</th><th>Image</th><th>Del</th></tr>`;

records.forEach((r,i)=>{
recordTable.innerHTML+=`<tr>
<td>${r.date}<br>${r.site}</td>
<td>${r.work}<br>IN:${r.inn} OUT:${r.out}</td>
<td>₹${r.pay}</td>
<td>${r.img?`<img src="${r.img}">`:""}</td>
<td><button class="del" onclick="delRec(${i})">X</button></td>
</tr>`;
});
}

function saveDaily(){
let w=workers[workerSelect.value];
let pay=w.rate*parseFloat(hajri.value);

let reader=new FileReader();
reader.onload=()=>{
records.push({
date:date.value,site:site.value,work:work.value,
inn:in.value,out:out.value,
worker:w.name,pay:pay,img:reader.result
});
save(); load();
}
if(img.files[0]) reader.readAsDataURL(img.files[0]);
else reader.onload();
}

function delRec(i){
records.splice(i,1); save(); load();
}

function dailyPDF(){
const {jsPDF}=window.jspdf;
let pdf=new jsPDF();
let y=10;
records.forEach(r=>{
pdf.text(`${r.date} ${r.site}`,10,y); y+=6;
pdf.text(`Work: ${r.work}`,10,y); y+=6;
pdf.text(`Payment: ₹${r.pay}`,10,y); y+=6;
if(r.img) pdf.addImage(r.img,'JPEG',10,y,40,30),y+=32;
y+=5;
});
pdf.save("Daily_Record.pdf");
}

function hisab(){
let w=workers[hisabWorker.value];
let f=new Date(from.value),t=new Date(to.value);
let total=0,days=0;
records.forEach(r=>{
let d=new Date(r.date);
if(r.worker==w.name && d>=f && d<=t){
total+=r.pay; days++;
}
});
hisabResult.innerHTML=`${w.name} worked ${days} days | Total ₹${total}`;
}

function hisabPDF(){
const {jsPDF}=window.jspdf;
let pdf=new jsPDF();
pdf.text(hisabResult.innerText,10,20);
pdf.save("Hisab_Kitab.pdf");
}

load();
</script>
</body>
</html>
