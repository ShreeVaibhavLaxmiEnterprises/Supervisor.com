<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shree Vaibhav Laxmi Enterprises</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
.container{max-width:1100px;margin:auto;background:#fff;padding:15px}
h1{text-align:center;margin:5px}
.section{border:1px solid #ccc;margin-top:15px}
.section h3{background:#2c3e50;color:#fff;padding:8px;margin:0}
.row{display:flex;flex-wrap:wrap;gap:10px;padding:10px}
.row input,select,textarea{padding:6px;width:100%}
.col{flex:1;min-width:150px}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #aaa;padding:6px;text-align:center}
button{padding:8px 14px;background:#e67e22;color:#fff;border:none;cursor:pointer}
button:hover{opacity:.9}
.save{width:100%;margin-top:10px;font-size:16px}
.history{max-height:300px;overflow:auto}
</style>
</head>

<body>
<div class="container">

<h1>SHREE VAIBHAV LAXMI ENTERPRISES</h1>

<!-- BASIC DETAILS -->
<div class="section">
<h3>1. Basic Details</h3>
<div class="row">
<div class="col"><input type="date" id="date"></div>
<div class="col"><input placeholder="Site Name" id="site"></div>
<div class="col"><input placeholder="Supervisor Name"></div>
</div>
</div>

<!-- LABOUR -->
<div class="section">
<h3>2. Labour Details</h3>
<table id="labourTable">
<tr>
<th>Name</th><th>Type</th><th>Rate</th><th>Att</th><th>Adv</th><th>Payable</th><th>X</th>
</tr>
</table>
<div style="padding:10px">
<button onclick="addWorker()">+ Add Worker</button>
</div>
</div>

<button class="save" onclick="saveRecord()">ðŸ’¾ Save Report</button>
<button class="save" onclick="downloadPDF()">ðŸ“„ Download PDF</button>
<button class="save" onclick="exportExcel()">ðŸ“Š Export Excel</button>

<!-- FILTER -->
<div class="section">
<h3>ðŸ“… Date Wise Filter</h3>
<div class="row">
<input type="date" id="filterDate" onchange="loadHistory()">
<button onclick="clearFilter()">Clear</button>
</div>
</div>

<!-- HISTORY -->
<div class="section">
<h3>ðŸ“Š Saved Labour Records</h3>
<div class="history">
<table>
<tr>
<th>Date</th><th>Site</th><th>Name</th><th>Type</th>
<th>Rate</th><th>Att</th><th>Adv</th><th>Pay</th>
</tr>
<tbody id="historyData"></tbody>
</table>
</div>
</div>

<!-- WORKER SUMMARY -->
<div class="section">
<h3>ðŸ‘· Worker Wise Total Salary</h3>
<table>
<tr><th>Name</th><th>Total Days</th><th>Total Pay (â‚¹)</th></tr>
<tbody id="workerSummary"></tbody>
</table>
</div>

<!-- MONTHLY -->
<div class="section">
<h3>ðŸ“Š Monthly Summary</h3>
<div class="row">
<input type="month" id="monthFilter" onchange="loadMonthlySummary()">
</div>
<table>
<tr><th>Month</th><th>Total Attendance</th><th>Total Cost (â‚¹)</th></tr>
<tbody id="monthlySummary"></tbody>
</table>
</div>

</div>

<script>
let workerMaster = JSON.parse(localStorage.getItem("workerMaster")) || [];

function addWorker(){
 let t=document.getElementById("labourTable");
 let r=t.insertRow();
 let opt=workerMaster.map(w=>`<option value="${w}">`).join("");
 r.innerHTML=`
 <td>
 <input list="workers" onblur="saveWorker(this.value)">
 <datalist id="workers">${opt}</datalist>
 </td>
 <td><select><option>Carpenter</option><option>Helper</option></select></td>
 <td><input type="number" value="0" oninput="calc(this)"></td>
 <td><input type="number" value="1" oninput="calc(this)"></td>
 <td><input type="number" value="0" oninput="calc(this)"></td>
 <td class="pay">0</td>
 <td><button onclick="this.parentElement.parentElement.remove()">X</button></td>`;
}

function saveWorker(n){
 if(n && !workerMaster.includes(n)){
  workerMaster.push(n);
  localStorage.setItem("workerMaster",JSON.stringify(workerMaster));
 }
}

function calc(e){
 let r=e.parentElement.parentElement;
 let rate=r.cells[2].querySelector("input").value;
 let att=r.cells[3].querySelector("input").value;
 let adv=r.cells[4].querySelector("input").value;
 r.cells[5].innerText=(rate*att)-adv;
}

function saveRecord(){
 let data=JSON.parse(localStorage.getItem("labourData"))||[];
 document.querySelectorAll("#labourTable tr").forEach((r,i)=>{
 if(i===0)return;
 data.push({
 date:date.value,
 site:site.value,
 name:r.cells[0].querySelector("input").value,
 type:r.cells[1].querySelector("select").value,
 rate:r.cells[2].querySelector("input").value,
 att:r.cells[3].querySelector("input").value,
 adv:r.cells[4].querySelector("input").value,
 pay:r.cells[5].innerText
 });
 });
 localStorage.setItem("labourData",JSON.stringify(data));
 loadHistory(); loadWorkerSummary(); loadMonthlySummary();
 alert("Saved âœ…");
}

function loadHistory(){
 let data=JSON.parse(localStorage.getItem("labourData"))||[];
 let f=document.getElementById("filterDate").value;
 let h="";
 data.forEach(d=>{
 if(f && d.date!==f)return;
 h+=`<tr><td>${d.date}</td><td>${d.site}</td><td>${d.name}</td>
 <td>${d.type}</td><td>${d.rate}</td><td>${d.att}</td>
 <td>${d.adv}</td><td>${d.pay}</td></tr>`;
 });
 historyData.innerHTML=h;
}

function clearFilter(){filterDate.value="";loadHistory();}

function loadWorkerSummary(){
 let data=JSON.parse(localStorage.getItem("labourData"))||[];
 let m={}; let h="";
 data.forEach(d=>{
 if(!m[d.name])m[d.name]={days:0,pay:0};
 m[d.name].days+=Number(d.att);
 m[d.name].pay+=Number(d.pay);
 });
 for(let n in m){
 h+=`<tr><td>${n}</td><td>${m[n].days}</td><td>${m[n].pay}</td></tr>`;
 }
 workerSummary.innerHTML=h;
}

function loadMonthlySummary(){
 let data=JSON.parse(localStorage.getItem("labourData"))||[];
 let m=document.getElementById("monthFilter").value;
 let att=0,pay=0;
 data.forEach(d=>{
 if(d.date.startsWith(m)){
 att+=Number(d.att); pay+=Number(d.pay);
 }
 });
 monthlySummary.innerHTML=m?`<tr><td>${m}</td><td>${att}</td><td>${pay}</td></tr>`:"";
}

function downloadPDF(){window.print();}

function exportExcel(){
 let d=JSON.parse(localStorage.getItem("labourData"))||[];
 let csv="Date,Site,Name,Type,Rate,Att,Adv,Pay\n";
 d.forEach(r=>{
 csv+=`${r.date},${r.site},${r.name},${r.type},${r.rate},${r.att},${r.adv},${r.pay}\n`;
 });
 let b=new Blob([csv],{type:"text/csv"});
 let a=document.createElement("a");
 a.href=URL.createObjectURL(b);
 a.download="Labour_Report.csv";
 a.click();
}

loadHistory(); loadWorkerSummary();
</script>

</body>
</html>
